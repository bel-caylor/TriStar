---
title: "Family"
layout: layouts/base.njk
permalink: "family/"
---

<div x-data="familyTableComponent()" x-init="loadData()" class="page-container mx-auto px-4">
  <header class="page-header">
    <div class="block lg:flex items-center">
      <h1>{{title}}</h1>
      <p class="page-desc lg:pl-8">
        Edit as needed, or leave it alone if all looks in order.
      </p>
    </div>
    <!-- Add button -->
    <div class="flex items-center justify-end mb-4">
      <button type="button" class="btn btn-submit" @click="openAdd()">
        Add a New Family Member
      </button>
    </div>
  </header>

  <div class="family-section">
    {% include "components/table-family.njk" %}
    {% include "components/modal-family.njk" %}
  </div>
</div>


<script>
  function familyTableComponent() {
    return {
      // ─── State ────────────────────────────────────────────────
      employee: {},
      familyMembers: [],
      editingMember: {},
      showModal: false,
      isEdit: false,

      // ─── Initialization ────────────────────────────────────────
      async loadData() {
        try {
          const res = await fetch("/familyMembers.json");
          if (!res.ok) throw new Error("Could not load employee.json");

          const data = await res.json();
          this.familyMembers = Array.isArray(data) ? data : [];

        } catch (err) {
          console.error("Error loading data:", err);
        }
      },

      // ─── Modal controls ─────────────────────────────────────────
      openAdd() {
        this.isEdit = false;
        this.editingMember = {
          id: "",
          firstName: "",
          middleInitial: "",
          lastName: "",
          suffix: "",
          ssn: "",
          birthDate: "",
          relation: "",
          gender: "",
          disabled: false,
          verified: false,
          termDate: ""
        };
        this.showModal = true;
      },

      openEdit(member) {
        this.isEdit = true;
        // Deep‐clone to avoid mutating the live array until Save
        this.editingMember = JSON.parse(JSON.stringify(member));
        this.showModal = true;
      },

      closeModal() {
        this.showModal = false;
      },

      saveMember() {
        if (this.isEdit) {
          // Replace the edited member in place
          const idx = this.familyMembers.findIndex(m => m.id === this.editingMember.id);
          if (idx !== -1) {
            this.familyMembers.splice(idx, 1, JSON.parse(JSON.stringify(this.editingMember)));
          }
        } else {
          // Assign a fresh ID (timestamp‐based) and push
          const newId = Date.now().toString();
          this.editingMember.id = newId;
          this.editingMember.verified = false;
          this.familyMembers.push(JSON.parse(JSON.stringify(this.editingMember)));
        }
        this.closeModal();
      },

      removeMember(id) {
        this.familyMembers = this.familyMembers.filter(m => m.id !== id);
      }
    };
  }
</script>